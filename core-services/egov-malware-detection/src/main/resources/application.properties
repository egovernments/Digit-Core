# Server Configuration
server.contextPath=/malware-detection
server.port=8087
app.timezone=UTC

# Database Configuration
spring.datasource.driver-class-name=io.opentelemetry.instrumentation.jdbc.OpenTelemetryDriver
spring.datasource.url=jdbc:otel:postgresql://localhost:5432/postgres
spring.datasource.username=postgres
spring.datasource.password=postgres

# JPA Configuration
spring.jpa.generate-ddl=true
spring.jpa.show-sql=false
spring.jpa.database=POSTGRESQL
spring.jpa.hibernate.ddl-auto=none

# Flyway Configuration
spring.flyway.enabled=true
spring.flyway.user=${spring.datasource.username}
spring.flyway.password=${spring.datasource.password}
spring.flyway.table=egov_malware_schema_version
spring.flyway.baseline-on-migrate=true
spring.flyway.locations=classpath:/db/migration/ddl

# ClamAV Configuration
#clamav.host=clamav.security.svc.cluster.local
clamav.host=localhost
clamav.port=3310
clamav.timeout=60000
clamav.chunk.size=2048

# S3/MinIO Configuration (aligned with egov-filestore)
isS3Enabled=true
minio.url=http://localhost:9000
aws.key=${AWS_KEY:minioadmin}
aws.secretkey=${AWS_SECRETKEY:minioadmin}
fixed.bucketname=egov-rainmaker
fixed.bucket.region=ap-south-1
quarantine.bucketname=egov-quarantine
minio.source=minio

# Filestore Service Configuration
egov.filestore.host=http://egov-filestore.egov:8080/
egov.filestore.path=filestore/v1/files/id

# Kafka Configuration
spring.kafka.bootstrap-servers=localhost:9092
spring.kafka.consumer.group-id=malware-detection-group
spring.kafka.consumer.key-deserializer=org.apache.kafka.common.serialization.StringDeserializer
spring.kafka.consumer.value-deserializer=org.egov.tracer.kafka.deserializer.HashMapDeserializer
spring.kafka.producer.key-serializer=org.apache.kafka.common.serialization.StringSerializer
spring.kafka.producer.value-serializer=org.springframework.kafka.support.serializer.JsonSerializer
spring.kafka.listener.missing-topics-fatal=false
spring.kafka.consumer.properties.spring.json.use.type.headers=false

# =============================================================================
# KAFKA TOPICS - MALWARE DETECTION
# =============================================================================
# All malware-related topics follow the naming convention: egov.malware.<action>

# Scan Request Topic (INPUT)
# - Published by: egov-filestore (after file upload)
# - Consumed by: egov-malware-detection (triggers scan workflow)
kafka.topics.malware.scan.request=egov.malware.file-scan-request

# Scan Result Topic (OUTPUT)
# - Published by: egov-malware-detection (after scan completes)
# - Consumed by: Any service needing real-time scan results
kafka.topics.malware.scan.result=egov.malware.scan-completed

# Scan Result Persistence Topic (INTERNAL)
# - Published by: egov-malware-detection (after enrichment)
# - Consumed by: egov-malware-detection persister consumer
kafka.topics.malware.scan.save=egov.malware.persist-scan-result

# Slack Configuration
slack.webhook.enabled=true
slack.webhook.url=your-webhook-url
slack.channel=#filestore-malware-alerts
slack.username=MalwareBot
slack.icon.emoji=:warning:

# Email Configuration
mail.enabled=true

# Email Notification Mode: "direct" (JavaMailSender) or "kafka" (egov-notification-mail)
# - direct: Sends email directly using SMTP configuration below
# - kafka: Publishes to Kafka topic for egov-notification-mail service to send
mail.notification.mode=kafka

# Kafka topic for egov-notification-mail (used when mode=kafka)
kafka.topics.notification.email=egov.core.notification.email

# SMTP Configuration (used when mode=direct)
mail.host=smtp.gmail.com
mail.port=465
mail.protocol=smtps
mail.sender.username=security@example.com
mail.sender.password=test
mail.smtps.auth=true
mail.smtps.starttls.enable=true
mail.smtps.debug=false

# Alert Recipients and Subject
mail.alert.recipients=security@example.com
mail.alert.subject=DIGIT Security Alert

# Scan Settings
scan.max.file.size.mb=50

# Quarantine Settings
quarantine.enabled=true
quarantine.delete.original=true

# State/Tenant Configuration
egov.state.tenant.id=pb

# OpenTelemetry Configuration
otel.traces.exporter=otlp
otel.service.name=egov-malware-detection
otel.logs.exporter=none
otel.metrics.exporter=none
otel.exporter.otlp.endpoint=http://jaeger-collector.tracing:4318
otel.exporter.otlp.protocol=http/protobuf
otel.instrumentation.kafka.enabled=true
otel.instrumentation.kafka.experimental-span-attributes=true
otel.instrumentation.http.server.ignore-urls=/egov-malware-detection/health,/egov-malware-detection/prometheus

# Management/Actuator
management.endpoints.web.exposure.include=health,info,prometheus
management.endpoint.health.show-details=always

# Logging
logging.level.org.egov.malware=INFO
logging.level.org.springframework.kafka=WARN
