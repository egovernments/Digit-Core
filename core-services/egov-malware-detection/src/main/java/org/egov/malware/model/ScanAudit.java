package org.egov.malware.model;

import com.fasterxml.jackson.annotation.JsonProperty;
import lombok.*;

/**
 * Model representing an audit log entry for malware scan actions.
 * Maps to the eg_malware_scan_audit table.
 */
@Data
@Builder
@NoArgsConstructor
@AllArgsConstructor
public class ScanAudit {

    @JsonProperty("id")
    private Long id;

    @JsonProperty("scanResultId")
    private String scanResultId;

    @JsonProperty("fileStoreId")
    private String fileStoreId;

    @JsonProperty("tenantId")
    private String tenantId;

    @JsonProperty("action")
    private AuditAction action;

    @JsonProperty("actionDetails")
    private String actionDetails;

    @JsonProperty("actionTime")
    private Long actionTime;

    @JsonProperty("actionBy")
    private String actionBy;

    /**
     * Creates a new audit entry with current timestamp.
     */
    public static ScanAudit create(String scanResultId, String fileStoreId, String tenantId,
                                    AuditAction action, String actionDetails, String actionBy) {
        return ScanAudit.builder()
                .scanResultId(scanResultId)
                .fileStoreId(fileStoreId)
                .tenantId(tenantId)
                .action(action)
                .actionDetails(actionDetails)
                .actionTime(System.currentTimeMillis())
                .actionBy(actionBy)
                .build();
    }

    /**
     * Creates an audit entry from a ScanResult.
     */
    public static ScanAudit fromScanResult(ScanResult scanResult, AuditAction action, String actionDetails) {
        return ScanAudit.builder()
                .scanResultId(scanResult.getId())
                .fileStoreId(scanResult.getFileStoreId())
                .tenantId(scanResult.getTenantId())
                .action(action)
                .actionDetails(actionDetails)
                .actionTime(System.currentTimeMillis())
                .actionBy(scanResult.getCreatedBy())
                .build();
    }
}
