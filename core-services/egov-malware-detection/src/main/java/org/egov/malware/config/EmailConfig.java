package org.egov.malware.config;

import lombok.Getter;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.boot.autoconfigure.condition.ConditionalOnProperty;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.mail.javamail.JavaMailSenderImpl;

import java.util.Properties;

@Configuration
@Getter
@ConditionalOnProperty(value = "mail.enabled", havingValue = "true")
public class EmailConfig {

    @Value("${mail.host}")
    private String mailHost;

    @Value("${mail.port}")
    private int mailPort;

    @Value("${mail.protocol}")
    private String mailProtocol;

    @Value("${mail.sender.username}")
    private String mailUsername;

    @Value("${mail.sender.password}")
    private String mailPassword;

    @Value("${mail.smtps.auth}")
    private String mailSmtpsAuth;

    @Value("${mail.smtps.starttls.enable}")
    private String mailStartTlsEnabled;

    @Value("${mail.smtps.debug}")
    private String mailSmtpsDebug;

    @Bean
    public JavaMailSenderImpl mailSender() {
        JavaMailSenderImpl mailSender = new JavaMailSenderImpl();
        mailSender.setHost(mailHost);
        mailSender.setPort(mailPort);
        mailSender.setProtocol(mailProtocol);
        mailSender.setUsername(mailUsername);
        mailSender.setPassword(mailPassword);

        Properties mailProperties = new Properties();
        mailProperties.setProperty("mail.smtps.auth", mailSmtpsAuth);
        mailProperties.setProperty("mail.smtps.starttls.enable", mailStartTlsEnabled);
        mailProperties.setProperty("mail.smtps.debug", mailSmtpsDebug);
        mailSender.setJavaMailProperties(mailProperties);

        return mailSender;
    }
}
